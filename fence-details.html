<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSEB Fence Details - Live Monitor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #003f7f 0%, #8B4AAE 100%);
            min-height: 100vh;
            color: #1a1a1a;
        }

        .app-container {
            max-width: 400px;
            margin: 0 auto;
            background: #ffffff;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            overflow-x: hidden;
        }

        .header {
            background: #003f7f;
            color: white;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: relative;
        }

        .back-btn {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
        }

        .header h1 {
            font-size: 18px;
            margin: 5px 0;
            font-weight: bold;
        }

        .header .subtitle {
            font-size: 12px;
            opacity: 0.9;
        }

        .dashboard {
            padding: 20px;
        }

        .device-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .device-info h3 {
            color: #003f7f;
            margin-bottom: 10px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 14px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .info-label {
            color: #666;
            font-weight: 500;
        }

        .info-value {
            font-weight: bold;
            color: #003f7f;
        }

        .meter-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .meter-container {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }

        .meter-circle {
            width: 200px;
            height: 200px;
            border: 8px solid #e0e0e0;
            border-radius: 50%;
            position: relative;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
        }

        .meter-progress {
            width: 200px;
            height: 200px;
            border: 8px solid transparent;
            border-radius: 50%;
            position: absolute;
            top: -8px;
            left: -8px;
            transform: rotate(-90deg);
            transition: all 0.5s ease;
        }

        .meter-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            font-weight: bold;
            color: #003f7f;
        }

        .meter-unit {
            font-size: 16px;
            color: #666;
            margin-top: 5px;
        }

        .meter-label {
            font-size: 14px;
            color: #8B4AAE;
            margin-top: 10px;
            font-weight: 600;
        }

        .sos-alert {
            background: #dc3545;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            display: none;
            animation: flashAlert 1s infinite alternate;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
        }

        .sos-alert.active {
            display: block;
        }

        .sos-alert h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .sos-alert p {
            font-size: 14px;
            opacity: 0.9;
        }

        @keyframes flashAlert {
            0% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .status-card {
            background: white;
            border: 2px solid #8B4AAE;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(139, 74, 174, 0.2);
        }

        .status-card h4 {
            color: #8B4AAE;
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .status-card .value {
            font-size: 18px;
            font-weight: bold;
            color: #003f7f;
        }

        .system-status {
            background: #28a745;
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
        }

        .system-status.warning {
            background: #fd7e14;
        }

        .system-status.critical {
            background: #dc3545;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .controls {
            margin: 30px 0;
            text-align: center;
        }

        .btn {
            background: #003f7f;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #8B4AAE;
            transform: translateY(-2px);
        }

        .btn.secondary {
            background: #8B4AAE;
        }

        .btn.secondary:hover {
            background: #003f7f;
        }

        .footer {
            background: #003f7f;
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 12px;
        }

        .connection-status {
            position: absolute;
            top: 15px;
            right: 20px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #28a745;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .chart-title {
            color: #003f7f;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .mini-chart {
            height: 100px;
            background: linear-gradient(to right, #e3f2fd, #bbdefb);
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        .chart-line {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 60%;
            width: 100%;
            background: linear-gradient(45deg, #003f7f, #8B4AAE);
            border-radius: 5px 5px 0 0;
            animation: chartPulse 3s infinite;
        }

        @keyframes chartPulse {
            0%, 100% { height: 60%; }
            50% { height: 80%; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <button class="back-btn" onclick="goBack()">← Back</button>
            <div class="connection-status" id="connectionStatus"></div>
            <h1 id="deviceTitle">⚡ KSEB FENCE DETAILS</h1>
            <p class="subtitle" id="deviceSubtitle">Real-Time Monitoring</p>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard">
            <!-- Device Info -->
            <div class="device-info">
                <h3 id="deviceName">Loading Device Info...</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Device ID:</span>
                        <span class="info-value" id="deviceId">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Location:</span>
                        <span class="info-value" id="deviceLocation">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Owner:</span>
                        <span class="info-value" id="deviceOwner">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Contact:</span>
                        <span class="info-value" id="deviceContact">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Last Update:</span>
                        <span class="info-value" id="lastUpdateTime">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Status:</span>
                        <span class="info-value" id="deviceStatus">--</span>
                    </div>
                </div>
            </div>

            <!-- Current Meter -->
            <div class="meter-section">
                <div class="meter-container">
                    <div class="meter-circle">
                        <div class="meter-progress" id="meterProgress"></div>
                        <div class="meter-value">
                            <span id="currentValue">0.0</span>
                            <div class="meter-unit">AMPS</div>
                        </div>
                    </div>
                    <div class="meter-label">Electric Fence Current Monitor</div>
                </div>
            </div>

            <!-- SOS Alert -->
            <div class="sos-alert" id="sosAlert">
                <h3>⚠️ SOS ALERT - OVERCURRENT DETECTED</h3>
                <p id="sosMessage">Current exceeds 13A safety threshold!</p>
                <p>Emergency notification sent to KSEB officials</p>
            </div>

            <!-- System Status -->
            <div class="system-status" id="systemStatus">
                <strong>🟢 SYSTEM NORMAL</strong>
                <p>Electric fence operating within safe parameters</p>
            </div>

            <!-- Status Cards -->
            <div class="status-grid">
                <div class="status-card">
                    <h4>Current Reading</h4>
                    <div class="value" id="currentReading">0.0A</div>
                </div>
                <div class="status-card">
                    <h4>Daily Peak</h4>
                    <div class="value" id="dailyPeak">0.0A</div>
                </div>
                <div class="status-card">
                    <h4>Voltage</h4>
                    <div class="value" id="voltage">0.0kV</div>
                </div>
                <div class="status-card">
                    <h4>Connection</h4>
                    <div class="value" id="connectionStatus">Online</div>
                </div>
            </div>

            <!-- Mini Chart -->
            <div class="chart-container">
                <div class="chart-title">📈 Current Trend (Last 24 Hours)</div>
                <div class="mini-chart">
                    <div class="chart-line"></div>
                </div>
                <p style="text-align: center; font-size: 12px; color: #666; margin-top: 10px;">
                    Real-time data visualization showing current fluctuations
                </p>
            </div>

            <!-- Controls -->
            <div class="controls">
                <button class="btn" onclick="refreshData()">🔄 Refresh Data</button>
                <button class="btn secondary" onclick="testAlert()">🚨 Test Alert</button>
                <button class="btn" onclick="viewHistory()">📊 View History</button>
                <button class="btn secondary" onclick="exportData()">📋 Export Data</button>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>© 2025 Kerala State Electricity Board Limited</p>
            <p>Smart India Hackathon 2025 - Live Monitoring System</p>
        </div>
    </div>

    <script>
        // Get fence ID from localStorage (passed from main dashboard)
        const selectedFenceId = localStorage.getItem('selectedFenceId') || 'KSEB_001';
        
        // Sample detailed data (in real app, this would come from API)
        const detailedFenceData = {
            "KSEB_001": {
                id: "KSEB_001",
                name: "Thiruvananthapuram Central",
                location: "TVM District Office",
                current: 11.2,
                voltage: 8.5,
                dailyPeak: 12.1,
                owner: "District Collector Office",
                contact: "+91-471-2345678",
                lastUpdate: new Date(),
                status: "normal"
            },
            "KSEB_002": {
                id: "KSEB_002",
                name: "Kochi Industrial Zone", 
                location: "Kakkanad IT Park",
                current: 14.7,
                voltage: 8.3,
                dailyPeak: 15.2,
                owner: "IT Park Authority",
                contact: "+91-484-2345678",
                lastUpdate: new Date(),
                status: "critical"
            },
            "KSEB_003": {
                id: "KSEB_003",
                name: "Kozhikode Beach Road",
                location: "Beach Road Substation", 
                current: 9.8,
                voltage: 8.7,
                dailyPeak: 11.3,
                owner: "Tourism Department",
                contact: "+91-495-2345678",
                lastUpdate: new Date(),
                status: "normal"
            },
            "KSEB_004": {
                id: "KSEB_004",
                name: "Thrissur Cultural Center",
                location: "Swaraj Round",
                current: 12.9,
                voltage: 8.4,
                dailyPeak: 13.4,
                owner: "Cultural Affairs Dept",
                contact: "+91-487-2345678",
                lastUpdate: new Date(),
                status: "warning"
            },
            "KSEB_005": {
                id: "KSEB_005",
                name: "Kollam Port Authority",
                location: "Kollam Port Complex",
                current: 10.5,
                voltage: 8.6,
                dailyPeak: 11.8,
                owner: "Port Trust",
                contact: "+91-474-2345678",
                lastUpdate: new Date(),
                status: "normal"
            },
            "KSEB_006": {
                id: "KSEB_006",
                name: "Palakkad Railway Junction",
                location: "Railway Station Perimeter",
                current: 13.2,
                voltage: 8.2,
                dailyPeak: 13.8,
                owner: "Indian Railways",
                contact: "+91-491-2345678",
                lastUpdate: new Date(),
                status: "warning"
            },
            "KSEB_007": {
                id: "KSEB_007",
                name: "Malappuram Govt Complex",
                location: "District Collectorate",
                current: 8.7,
                voltage: 8.8,
                dailyPeak: 10.2,
                owner: "District Administration",
                contact: "+91-483-2345678",
                lastUpdate: new Date(),
                status: "normal"
            },
            "KSEB_008": {
                id: "KSEB_008",
                name: "Kannur Airport Perimeter",
                location: "International Airport",
                current: 11.8,
                voltage: 8.4,
                dailyPeak: 12.5,
                owner: "Airport Authority",
                contact: "+91-497-2345678",
                lastUpdate: new Date(),
                status: "normal"
            },
            "KSEB_009": {
                id: "KSEB_009",
                name: "Wayanad Tourist Center",
                location: "Vythiri Resort Area",
                current: 7.9,
                voltage: 8.9,
                dailyPeak: 9.1,
                owner: "Forest Department",
                contact: "+91-493-2345678",
                lastUpdate: new Date(),
                status: "normal"
            },
            "KSEB_010": {
                id: "KSEB_010",
                name: "Idukki Dam Security",
                location: "Dam Perimeter Fence",
                current: 12.4,
                voltage: 8.3,
                dailyPeak: 13.1,
                owner: "Dam Authority",
                contact: "+91-486-2345678",
                lastUpdate: new Date(),
                status: "normal"
            }
        };

        let currentFence = null;

        function goBack() {
            window.close();
        }

        function getStatusClass(current) {
            if (current >= 13.0) return 'critical';
            if (current >= 11.0) return 'warning';
            return 'normal';
        }

        function getStatusText(current) {
            if (current >= 13.0) return 'Critical';
            if (current >= 11.0) return 'Warning';
            return 'Normal';
        }

        function loadFenceDetails() {
            currentFence = detailedFenceData[selectedFenceId];
            
            if (!currentFence) {
                console.error('Fence not found:', selectedFenceId);
                return;
            }

            // Update header
            document.getElementById('deviceTitle').textContent = `⚡ ${currentFence.id}`;
            document.getElementById('deviceSubtitle').textContent = currentFence.name;

            // Update device info
            document.getElementById('deviceName').textContent = currentFence.name;
            document.getElementById('deviceId').textContent = currentFence.id;
            document.getElementById('deviceLocation').textContent = currentFence.location;
            document.getElementById('deviceOwner').textContent = currentFence.owner;
            document.getElementById('deviceContact').textContent = currentFence.contact;
            document.getElementById('lastUpdateTime').textContent = currentFence.lastUpdate.toLocaleTimeString();
            document.getElementById('deviceStatus').textContent = getStatusText(currentFence.current);

            updateDisplay();
        }

        function updateDisplay() {
            if (!currentFence) return;

            const current = currentFence.current;
            
            // Update current value
            document.getElementById('currentValue').textContent = current.toFixed(1);
            document.getElementById('currentReading').textContent = current.toFixed(1) + 'A';
            document.getElementById('dailyPeak').textContent = currentFence.dailyPeak.toFixed(1) + 'A';
            document.getElementById('voltage').textContent = currentFence.voltage.toFixed(1) + 'kV';

            // Update meter progress
            const percentage = (current / 20) * 100;
            const meterProgress = document.getElementById('meterProgress');
            
            // Color coding based on current levels
            let borderColor;
            if (current >= 13.0) {
                borderColor = '#dc3545'; // Red - Critical
            } else if (current >= 11.0) {
                borderColor = '#fd7e14'; // Orange - Warning
            } else {
                borderColor = '#28a745'; // Green - Normal
            }
            
            meterProgress.style.borderTop = `8px solid ${borderColor}`;
            meterProgress.style.borderRight = `8px solid ${borderColor}`;
            meterProgress.style.transform = `rotate(${(percentage * 3.6) - 90}deg)`;

            // Update system status
            updateSystemStatus();
            
            // Update last reading timestamp
            document.getElementById('lastUpdateTime').textContent = currentFence.lastUpdate.toLocaleTimeString();
        }

        function updateSystemStatus() {
            const statusElement = document.getElementById('systemStatus');
            const sosAlert = document.getElementById('sosAlert');
            const sosMessage = document.getElementById('sosMessage');
            const current = currentFence.current;
            
            if (current >= 13.0) {
                // Critical - SOS Alert
                statusElement.className = 'system-status critical';
                statusElement.innerHTML = `
                    <strong>🔴 CRITICAL ALERT</strong>
                    <p>Overcurrent detected: ${current.toFixed(1)}A at ${currentFence.name}</p>
                `;
                
                // Show SOS alert
                sosAlert.classList.add('active');
                sosMessage.textContent = `Current ${current.toFixed(1)}A exceeds 13A threshold at ${currentFence.location}!`;
                
                // Play alert sound
                playAlertSound();
                
            } else if (current >= 11.0) {
                // Warning
                statusElement.className = 'system-status warning';
                statusElement.innerHTML = `
                    <strong>🟡 WARNING</strong>
                    <p>Approaching threshold: ${current.toFixed(1)}A at ${currentFence.name}</p>
                `;
                sosAlert.classList.remove('active');
                
            } else {
                // Normal
                statusElement.className = 'system-status';
                statusElement.innerHTML = `
                    <strong>🟢 SYSTEM NORMAL</strong>
                    <p>Electric fence operating within safe parameters</p>
                `;
                sosAlert.classList.remove('active');
            }
        }

        function playAlertSound() {
            // Create simple alert beep
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1);
            } catch (error) {
                console.log('Audio not available');
            }
        }

        function simulateRealTimeUpdates() {
            if (!currentFence) return;
            
            // Simulate realistic current variations
            const baseValue = currentFence.current;
            const variation = (Math.random() - 0.5) * 1.5; // ±0.75A variation
            currentFence.current = Math.max(0, Math.min(20, baseValue + variation));
            
            // Update timestamp
            currentFence.lastUpdate = new Date();
            
            // Update daily peak if needed
            if (currentFence.current > currentFence.dailyPeak) {
                currentFence.dailyPeak = currentFence.current;
            }

            updateDisplay();
        }

        function refreshData() {
            console.log('🔄 Refreshing data for', selectedFenceId);
            simulateRealTimeUpdates();
        }

        function testAlert() {
            currentFence.current = 14.5; // Trigger critical alert
            updateDisplay();
            
            setTimeout(() => {
                currentFence.current = 10.2; // Reset to normal
                updateDisplay();
            }, 5000);
        }

        function viewHistory() {
            alert(`📊 Viewing 24-hour history for ${currentFence.name}\n\nDaily Peak: ${currentFence.dailyPeak.toFixed(1)}A\nAverage: ${(currentFence.current * 0.8).toFixed(1)}A\nTotal Alerts: ${currentFence.current >= 13 ? '3' : '0'}`);
        }

        function exportData() {
            const data = `Device: ${currentFence.name}\nID: ${currentFence.id}\nCurrent: ${currentFence.current.toFixed(1)}A\nVoltage: ${currentFence.voltage}kV\nDaily Peak: ${currentFence.dailyPeak.toFixed(1)}A\nStatus: ${getStatusText(currentFence.current)}\nLast Update: ${currentFence.lastUpdate.toLocaleString()}`;
            
            // In a real app, this would download a CSV file
            alert(`📋 Data Export:\n\n${data}\n\n(In production, this would download a CSV file)`);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 KSEB Fence Details initialized for:', selectedFenceId);
            loadFenceDetails();
            
            // Start real-time updates every 3 seconds
            setInterval(simulateRealTimeUpdates, 3000);
        });
    </script>
</body>
</html>